<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    xhr 全面总结 |
    
    JackChouMine</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="outer">
  <article id="post-xhr-全面总结" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      xhr 全面总结
    </h1>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/2019/06/16/xhr-全面总结/" class="article-date">
  <time datetime="2019-06-16T09:30:54.000Z" itemprop="datePublished">2019-06-16</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/网络/">网络</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>AJAX(Asynchronous JavaScript Xml)，异步的JS xml，以前客户端和服务器 通信，一般传递 xml，但是现在传递 <code>JSON</code>为主，ajax 能实现页面部分更新，使得页面性能高和体验良好。AJAX 是一种向服务器发送 HTTP 请求，实现与服务器交互的技术，已经是HTTP请的代名词，但是不只支持 http 协议，还支持 <code>ftp</code>、<code>file</code>协议。</p>
<a id="more"></a>
<h2 id="一级xhr-二级-xhr"><a class="markdownIt-Anchor" href="#一级xhr-二级-xhr"></a> 一级xhr 二级 xhr</h2>
<p>一级xhr或者老版本的xhr，有一些缺点：</p>
<ul>
<li>只支持文本数据传输</li>
<li>无法读取和上传二进制文件</li>
<li>只用成功、失败、完成等状态，没进度信息</li>
<li>不能跨域</li>
</ul>
<p>二级xhr，改进了这些问题：</p>
<ul>
<li>可设置超时</li>
<li>formData 对象管理表单数据</li>
<li>文件上传</li>
<li>可跨域</li>
<li>可获取二进制文件</li>
<li>可获取传输进度</li>
</ul>
<h2 id="xmlhttprequest-对象"><a class="markdownIt-Anchor" href="#xmlhttprequest-对象"></a> XMLHttpRequest 对象</h2>
<p>ajax 技术的核心是 XMLHttpRequest 对象，简称XHR，现在较为先进的浏览器都支持（低版本的IE可滚粗了）创建 xhr 对象，<code>new</code> 一个即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br></pre></td></tr></table></figure>
<h3 id="xhr-的用法"><a class="markdownIt-Anchor" href="#xhr-的用法"></a> xhr 的用法</h3>
<p><strong>通常步骤：</strong><br>
第一步：<code>var xhr = new XMLHttpRequest()</code>—创建 xhr;<br>
第二步：<code>xhr.open(METHOD,URL,isAsync)</code>—启动xhr;<br>
第三步：<code>xhr.responseType = reposnseType</code>—设置返回值类型，默认 <code>''</code>,必须在返回值达到客户端前设置;<br>
第四步：<code>xhr.onreadystatechange=handleFun</code>—监听请求状态变化；<br>
第五步：<code>xhr.setRequestHeader('Content-Type','application/json;charset=utf-8')</code>—设置请求头，不需要设置，可省略，<code>必须在请求开启和发送之间设置</code>;<br>
第六步：<code>xhr.send(data)</code>—发送请求。</p>
<p>完整的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">http.open(<span class="string">'GET'</span>,<span class="string">'/endpoint'</span>,<span class="literal">true</span>);</span><br><span class="line">http.responseType = <span class="string">'json'</span>;</span><br><span class="line">http.onreaydstatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(http.readyState === <span class="number">4</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(http.status === <span class="number">200</span>)&#123;</span><br><span class="line">			 <span class="built_in">console</span>.log(http.response);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.error(http.response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">http.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	 <span class="built_in">console</span>.error(http.statusText);</span><br><span class="line">&#125;</span><br><span class="line">http.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="实例属性"><a class="markdownIt-Anchor" href="#实例属性"></a> 实例属性</h3>
<h4 id="readystate"><a class="markdownIt-Anchor" href="#readystate"></a> readyState</h4>
<p>只读属性，是一个<code>数字</code>，表示此时的 HTTP 请求状态。</p>
<table>
<thead>
<tr>
<th style="text-align:center">值</th>
<th style="text-align:left">状态</th>
<th style="text-align:center">其他</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:left">xhr创建，<code>open</code>方法还未调用</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:left"><code>open</code>已调用，<code>send</code>未调用，此时可设置请求头</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:left"><code>send</code>已调用，且服务器返回的<code>头信息</code>和<code>状态码</code>已经收到</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:left">正在接收响应<code>body</code>，收到部分信息。</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:left">已收到服务返回即请求<code>完成</code>，可能失败，可能成功</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>0   UNSENT  open() has not been called yet.<br>
1   OPENED  send() has been called.<br>
2   HEADERS_RECEIVED    send() has been called, and headers and status are available.<br>
3   LOADING Downloading; responseText holds partial data.<br>
4   DONE    The operation is complete.</p>
</blockquote>
<p>每当 <code>xhr</code>的状态发生变化，<code>readyState</code>属性就发生变化，就会触发<code>readyStateChange</code>事件，所以可在 readyStateChange 事件的监听函数里处理返回的请求信息。</p>
<h4 id="onreadystatechange"><a class="markdownIt-Anchor" href="#onreadystatechange"></a> onreadystatechange</h4>
<p>事件，指向一个函数。执行<code>abort</code>方法，也会改变 readyState。</p>
<h4 id="response"><a class="markdownIt-Anchor" href="#response"></a> response</h4>
<p>服务器返回的数据，只读，类型由 <code>responseType</code>决定。请求不成功或者数据不完整，值为	<code>null</code>。</p>
<h4 id="responetype"><a class="markdownIt-Anchor" href="#responetype"></a> responeType</h4>
<p>可写属性，指定响应格式，在 <code>open</code>之后<code>send</code>之前，设置返回的数据类型。</p>
<table>
<thead>
<tr>
<th style="text-align:left">值</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">‘’(空字符串)</td>
<td style="text-align:left">默认值，等同于<code>text</code>,适用大多数情况。只是设置该值时，才可获取<code>responseText</code></td>
</tr>
<tr>
<td style="text-align:left">json</td>
<td style="text-align:left">浏览器会自动调用<code>JSON.parse</code>解析JSON字符串，此时<code>response</code>是一个对象，<strong>不是字符串</strong></td>
</tr>
<tr>
<td style="text-align:left">blob</td>
<td style="text-align:left"><code>Blob</code>对象，二进制对象，请求图片，下载文件等</td>
</tr>
<tr>
<td style="text-align:left">document</td>
<td style="text-align:left"><code>Document</code> 对象，文档对象，HTML/XML文档对象等，收到返回值后不用解析HTML字符串，直接进行DOM操作</td>
</tr>
<tr>
<td style="text-align:left">arraybuffer</td>
<td style="text-align:left"><code>ArrayBuffer</code>对象,二进制数组</td>
</tr>
</tbody>
</table>
<h4 id="responsetext"><a class="markdownIt-Anchor" href="#responsetext"></a> responseText</h4>
<p>返回值类型是<code>String</code>，可用这个属性获取。也就是说 <code>responseType</code>设置<code>text</code>或者<code>''</code>，<code>response</code>和<code>responseText</code>是相同的。</p>
<h4 id="responsexml"><a class="markdownIt-Anchor" href="#responsexml"></a> responseXML</h4>
<p>返回值时 HMTL 或者 XML 对象，可用该属性获取，只读。该属性生效的前提是，响应头信息 <code>Content-Type</code>为 <code>text/xml</code>或者<code>application/xml</code>,这要求，发送请求前，将<code>responseType</code>设置为<code>document</code>。如果响应头信息	<code>Content-Type</code>不为 <code>text/xml</code>或者<code>application/xml</code>，就需要手动调用<code>overrideMimeType('text/xml')</code>，强制进行XML解析。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">http.open(<span class="string">'GET'</span>,<span class="string">'/'</span>,<span class="literal">true</span>);</span><br><span class="line">http.responseType = <span class="string">'document'</span>;</span><br><span class="line">http.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(http.reaydState === <span class="number">4</span> &amp;&amp; http.status  === <span class="number">200</span>)&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(http.responseXML);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">http.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h4 id="responseurl"><a class="markdownIt-Anchor" href="#responseurl"></a> responseURL</h4>
<p>只读，返回数据的服务器的url。和 open 里的 url 不一定相同，不含锚点。</p>
<h4 id="status-statustext"><a class="markdownIt-Anchor" href="#status-statustext"></a> status statusText</h4>
<p><code>status</code>一个整数，表示 HTTP 的状态码，只读，发出请求前，为	0。<br>
<code>statusText</code>是状态信息，只读，无返回状态信息，默认 <code>OK</code>。</p>
<table>
<thead>
<tr>
<th style="text-align:center">status</th>
<th style="text-align:center">statusText</th>
<th style="text-align:center">状态</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">200</td>
<td style="text-align:center">OK</td>
<td style="text-align:center">成功返回</td>
</tr>
<tr>
<td style="text-align:center">301</td>
<td style="text-align:center">Moved Permanently</td>
<td style="text-align:center">永久移动</td>
</tr>
<tr>
<td style="text-align:center">302</td>
<td style="text-align:center">Moved Temporarily</td>
<td style="text-align:center">暂时移动</td>
</tr>
<tr>
<td style="text-align:center">304</td>
<td style="text-align:center">Not Modified</td>
<td style="text-align:center">未修改</td>
</tr>
<tr>
<td style="text-align:center">307</td>
<td style="text-align:center">Temporary Redirect</td>
<td style="text-align:center">暂时重定向</td>
</tr>
<tr>
<td style="text-align:center">400</td>
<td style="text-align:center">Bad request</td>
<td style="text-align:center">无效请求</td>
</tr>
<tr>
<td style="text-align:center">401</td>
<td style="text-align:center">Unauthorized</td>
<td style="text-align:center">未授权</td>
</tr>
<tr>
<td style="text-align:center">403</td>
<td style="text-align:center">Forbindden</td>
<td style="text-align:center">禁止访问</td>
</tr>
<tr>
<td style="text-align:center">404</td>
<td style="text-align:center">Not Found</td>
<td style="text-align:center">未找到</td>
</tr>
<tr>
<td style="text-align:center">405</td>
<td style="text-align:center">Method not allowed</td>
<td style="text-align:center">方法不被允许</td>
</tr>
<tr>
<td style="text-align:center">500</td>
<td style="text-align:center">Internal server error</td>
<td style="text-align:center">服务器内部出错</td>
</tr>
<tr>
<td style="text-align:center">503</td>
<td style="text-align:center">Service unavailable</td>
<td style="text-align:center">服务不可用</td>
</tr>
</tbody>
</table>
<p>基本上 2xx和 304，返回正常。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(http.readyState ===<span class="number">4</span> )&#123;</span><br><span class="line">  <span class="keyword">if</span>((http.status &gt;= <span class="number">200</span> &amp;&amp; http.status &lt; <span class="number">300</span>)||(http.status === <span class="number">304</span>))&#123;</span><br><span class="line">		<span class="comment">//处理返回数据</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//返回出错</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="timeout-ontimeout"><a class="markdownIt-Anchor" href="#timeout-ontimeout"></a> timeout  ontimeout</h4>
<p><code>timeout</code>属性是一个整数，表示多少<code>毫秒</code>后，如果请求还未返回，就会自动终止。触发<code>timeout</code>事件， 为 0 ，表示无时间限制，不是整数，会先转换，成数字，转换失败，则不生效。<br>
<code>ontimeout</code>指向一个函数，<code>timeout</code>触发，就执行该函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">http.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'请求超时'</span>);</span><br><span class="line">&#125;</span><br><span class="line">http.onload =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(http.readyState === <span class="number">4</span> &amp;&amp; http.status === <span class="number">200</span>)&#123;</span><br><span class="line">		<span class="comment">//正常返回</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(http.statusText);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">http.open(<span class="string">'GET'</span>,<span class="string">'/users/12132'</span>,<span class="literal">true</span>);</span><br><span class="line">http.timeout = <span class="number">1000</span>*<span class="number">10</span>;<span class="comment">// 10 秒超时</span></span><br><span class="line">http.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h4 id="withcredentials"><a class="markdownIt-Anchor" href="#withcredentials"></a> withCredentials</h4>
<p>一个布尔值，表示跨域请求时，用户信息（Cookie、认证的 http 头信息）是否会包含在请求中，默认<code>false</code>。同源请求不需要设置。为了使得该属性生效，必须返回头信息 <code>Access-Control-Allow-Credentials</code>且值为	<code>true</code>。<br>
打开了，跨域会发送 cookie，还会设置Cookie。</p>
<h4 id="upload-用-ajax-发送文件"><a class="markdownIt-Anchor" href="#upload-用-ajax-发送文件"></a> upload 用 AJAX 发送文件</h4>
<p>xhr 不仅可以发送请求，还可发送送文件。发送文件后，<code>upload</code>属性可得到一个对象，通过该对象，可监听该对象的各个事件得到上传状态。<br>
显示上传进度：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">progress</span> <span class="attr">min</span>=<span class="string">"0"</span> <span class="attr">max</span>=<span class="string">"100"</span> <span class="attr">value</span>=<span class="string">"0"</span>&gt;</span>0% complete<span class="tag">&lt;/<span class="name">progress</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>监听<code>upload</code>对象的<code>progress</code>事件，可得到上传进度：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params">&#123;blodOrFile=null,type=<span class="string">'json'</span>&#125;</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> http = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">	http.open(<span class="string">'POST'</span>,<span class="string">'/srever'</span>,<span class="literal">true</span>);</span><br><span class="line">	http.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">	<span class="keyword">var</span> progressBar = <span class="built_in">document</span>.querySelector(<span class="string">'progress'</span>);</span><br><span class="line">	http.upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(event.lengthComputable)&#123;</span><br><span class="line">			progressBar.value = (event.load / event.total)*<span class="number">100</span>;</span><br><span class="line">			<span class="comment">// 兼容老式浏览器</span></span><br><span class="line">			progressBar.textContent = progressBar.value;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	http.send(blodOrFile);</span><br><span class="line">&#125;</span><br><span class="line">uploadFile(&#123;<span class="attr">blodOrFile</span>:<span class="keyword">new</span> Blod([<span class="string">'hello ajax'</span>])&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="事件属性"><a class="markdownIt-Anchor" href="#事件属性"></a> 事件属性</h3>
<p>可监听 xhr 的以下事件：<strong>书写顺序为触发顺序，监听这些事件，必须在send之前进行</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">事件</th>
<th style="text-align:left">何时触发</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">onloadstart</td>
<td style="text-align:center">loadstart</td>
<td style="text-align:left">请求发出,在 <code>readyState == 1</code> 和 <code>readyState == 2</code>之间,onloadstart 默认传入 progressEvent 对象</td>
</tr>
<tr>
<td style="text-align:center">onprogress</td>
<td style="text-align:center">progress</td>
<td style="text-align:left">正在发送或者加载返回的数据,onprogress 默认传入progressEvent对象</td>
</tr>
<tr>
<td style="text-align:center">onabort</td>
<td style="text-align:center">abort</td>
<td style="text-align:left">终止请求，比如调用<code>abort</code>，调用该方法，readyState 被设置为 0</td>
</tr>
<tr>
<td style="text-align:center">onerror</td>
<td style="text-align:center">error</td>
<td style="text-align:left">请求<code>失败</code></td>
</tr>
<tr>
<td style="text-align:center">ontimeout</td>
<td style="text-align:center">timeout</td>
<td style="text-align:left">请求<code>超时</code></td>
</tr>
<tr>
<td style="text-align:center">onload</td>
<td style="text-align:center">load</td>
<td style="text-align:left">请求<code>成功</code>，以上四个事件互斥，触发0次或者1次</td>
</tr>
<tr>
<td style="text-align:center">onloadend</td>
<td style="text-align:center">loadend</td>
<td style="text-align:left">请求<code>完成</code>,可能成功，可能失败。<strong>abort</strong>、<strong>load</strong>、<strong>timeout</strong>、<strong>readtState=4</strong>都会伴随着<strong>loadend</strong>,onloadend 默认传入 progressEvent 对象</td>
</tr>
<tr>
<td style="text-align:center">onreadystatechange</td>
<td style="text-align:center">readystatechange</td>
<td style="text-align:left">xhr状态，监听该事件，可得知请求是否<code>完成</code>，这个属性时<code>xhr</code>特有的，其他属性时<code>xhr.upload</code>和<code>xhr</code>共有的</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">http.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">var</span> responseText = xhr.responseText;</span><br><span class="line"> <span class="built_in">console</span>.log(responseText);</span><br><span class="line"> <span class="comment">// process the response.</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">http.onabort = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The request was aborted'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// `只有 onprogress 有一个事件参数`</span></span><br><span class="line">http.onprogress = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.loaded);<span class="comment">//已返回的数据量</span></span><br><span class="line">  <span class="built_in">console</span>.log(event.total);<span class="comment">//返回的总数据量</span></span><br><span class="line">  <span class="built_in">console</span>.log(event.lengthComputable);<span class="comment">//加载进度是否可计算</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleError</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'There was an error!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">http.addEventListener(<span class="string">'error'</span>, handleError);</span><br></pre></td></tr></table></figure>
<h3 id="onload-vs-onreadystatechange"><a class="markdownIt-Anchor" href="#onload-vs-onreadystatechange"></a> onload vs onreadyStateChange</h3>
<p>处理返回值，是在 <strong>onload</strong>还是在<strong>onreadyStateChange</strong>?</p>
<p>onload 等于 <code>readyState==4 &amp;&amp; xhr.status===200</code></p>
<p>loadend 事件的触发：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">onreadystatechange</span><br><span class="line">    readyState === <span class="number">4</span></span><br><span class="line">             ⇓</span><br><span class="line">onload / onerror / onabort</span><br><span class="line">             ⇓</span><br><span class="line">        onloadend</span><br></pre></td></tr></table></figure>
<p>使用 <code>onerror</code>并且不考虑老式浏览器，<code>推荐</code>用 <code>onload</code>而不用<code>onreadySateChange</code>。</p>
<h3 id="实例方法"><a class="markdownIt-Anchor" href="#实例方法"></a> 实例方法</h3>
<h4 id="open"><a class="markdownIt-Anchor" href="#open"></a> open</h4>
<p>在<code>open</code>方法中指定请求参数，返回值为<code>undefined</code>。<br>
<code>opend(METHOD,URL,isAsync,user,password)</code>,user 和 password 可选，统一请求，再次用<code>open</code>，就等同于调用<code>abort</code>。一般 URL 需要用 <code>encodeURI</code>或<code>encodeURICompent</code>编码。</p>
<h4 id="get-请求绕过缓存"><a class="markdownIt-Anchor" href="#get-请求绕过缓存"></a> GET 请求绕过缓存</h4>
<p>GET 请求会缓存，在 url 后面加时间戳可绕过缓存。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//foo.com/bar.html -&gt; http://foo.com/bar.html?12345</span></span><br><span class="line">http:<span class="comment">//foo.com/bar.html?foobar=baz -&gt; http://foo.com/bar.html?foobar=baz&amp;12345</span></span><br><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">oReq.open(<span class="string">"GET"</span>, url + ((<span class="regexp">/\?/</span>).test(url) ? <span class="string">"&amp;"</span> : <span class="string">"?"</span>) + (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime());</span><br><span class="line">oReq.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h4 id="send"><a class="markdownIt-Anchor" href="#send"></a> send</h4>
<p>send 用于发送数据，可发发送多种类型的数据。<br>
<code>String</code>、<code>Bold</code>、<code>Document</code>、<code>Formdata</code>、<code>ArrayBuffer</code>、<code>null</code>。</p>
<p>发送表单数据：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">'registration'</span> <span class="attr">name</span>=<span class="string">'registration'</span> <span class="attr">action</span>=<span class="string">'/register'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">name</span>=<span class="string">'username'</span> <span class="attr">value</span>=<span class="string">'张三'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'email'</span> <span class="attr">name</span>=<span class="string">'email'</span> <span class="attr">value</span>=<span class="string">'zhangsan@example.com'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'number'</span> <span class="attr">name</span>=<span class="string">'birthDate'</span> <span class="attr">value</span>=<span class="string">'1940'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'submit'</span> <span class="attr">onclick</span>=<span class="string">'return sendForm(this.form);'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendForm</span>(<span class="params">form</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData(form);<span class="comment">//对表单进行加工</span></span><br><span class="line">  formData.append(<span class="string">'csrf'</span>, <span class="string">'e69a18d7db1286040586e6da1950128c'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, form.action, <span class="literal">true</span>);</span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line">  xhr.send(formData);<span class="comment">//发送</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.querySelector(<span class="string">'#registration'</span>);</span><br><span class="line">sendForm(form);</span><br></pre></td></tr></table></figure>
<h4 id="setrequestheaderfiledvalue"><a class="markdownIt-Anchor" href="#setrequestheaderfiledvalue"></a> setRequestHeader(filed,value)</h4>
<p>设置请求头信息，open 之后，send 之前调用。</p>
<h4 id="overridemimetype"><a class="markdownIt-Anchor" href="#overridemimetype"></a> overrideMimeType()</h4>
<p>重新设置服务器返回的数据类型，必须在 send 之前调用。</p>
<h4 id="getresponseheaderfiledstring"><a class="markdownIt-Anchor" href="#getresponseheaderfiledstring"></a> getResponseHeader(filed):String</h4>
<p>获取某个响应头信息，参数不区分大小写。</p>
<h4 id="getresponseheadersstring"><a class="markdownIt-Anchor" href="#getresponseheadersstring"></a> getResponseHeaders():String</h4>
<p>获取所有响应头信息，每个头信息之间用 <code>\r\n</code>(换行)分割。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">date: Fri, <span class="number">08</span> Dec <span class="number">2017</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">30</span> GMT\r\n</span><br><span class="line">content-encoding: gzip\r\n</span><br><span class="line">x-content-type-options: nosniff\r\n</span><br><span class="line">server: meinheld/<span class="number">0.6</span><span class="number">.1</span>\r\n</span><br><span class="line">x-frame-options: DENY\r\n</span><br><span class="line">content-type: text/html; charset=utf<span class="number">-8</span>\r\n</span><br><span class="line">connection: keep-alive\r\n</span><br><span class="line">strict-transport-security: max-age=<span class="number">63072000</span>\r\n</span><br><span class="line">vary: Cookie, Accept-Encoding\r\n</span><br><span class="line">content-length: <span class="number">6502</span>\r\n</span><br><span class="line">x-xss-protection: <span class="number">1</span>; mode=block\r\n</span><br></pre></td></tr></table></figure>
<p>处理头信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = headers.trim().split(<span class="regexp">/[\r\n]+/</span>);</span><br><span class="line"><span class="keyword">var</span> headerMap = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">line</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> parts = line.split(<span class="string">': '</span>);<span class="comment">//注意 '' </span></span><br><span class="line">  <span class="keyword">var</span> header = parts.shift();<span class="comment">//删除第一个元素，原数组改变，随便获取到 头字段。一举两得，妙</span></span><br><span class="line">  <span class="keyword">var</span> value = parts.join(<span class="string">': '</span>);<span class="comment">//\r\n 去哪儿了</span></span><br><span class="line">  headerMap[header] = value;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">headerMap[<span class="string">'content-length'</span>] <span class="comment">// "6502"</span></span><br></pre></td></tr></table></figure>
<h4 id="abort"><a class="markdownIt-Anchor" href="#abort"></a> abort</h4>
<p>终止请求，使得 <code>readyState</code>为 4，<code>status</code>为 0。</p>
<h2 id="页面卸载时发送数据"><a class="markdownIt-Anchor" href="#页面卸载时发送数据"></a> 页面卸载时发送数据</h2>
<p>在页面卸载时发送数据，即在<code>unload</code>或者<code>beforeunload</code>的监听函数里，发送AJAX，但是不可靠。xhr 是异步的，可能在发送数据时，页面就卸载了，可打发送失败，那么用同步发送，但是同步发送数据，很多浏览器不支持，同步发送，用户体验不好。</p>
<p>用 <code>Navigator.sendBeacon(url,data)</code>，该方法与当前页面脱钩，作为浏览器任务，能保证把数据发出去。data 可以是字符串、表单对象、二进制对象等，返回 布尔值，true 说明发送成功，<code>可跨域</code>，<code>POST</code>，比较多的先进浏览器支持。<br>
请求头信息 <code>Content-Type</code>根据发送的 data 类型设置，且不能设置其他头字段。</p>
<table>
<thead>
<tr>
<th style="text-align:center">data</th>
<th style="text-align:center">Content-Type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Blod</td>
<td style="text-align:center">Blod</td>
</tr>
<tr>
<td style="text-align:center">formData</td>
<td style="text-align:center">multipart/form-data</td>
</tr>
<tr>
<td style="text-align:center">String</td>
<td style="text-align:center">text/plain</td>
</tr>
</tbody>
</table>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// HTML 代码如下</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"analytics('start')"</span> <span class="attr">onunload</span>=<span class="string">"analytics('end')"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JS:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">analytics</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!navigator.sendBeacon) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> URL = <span class="string">'http://example.com/analytics'</span>;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">'state='</span> + state + <span class="string">'&amp;location='</span> + <span class="built_in">window</span>.location;</span><br><span class="line">  navigator.sendBeacon(URL, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> headers = &#123;<span class="attr">type</span>: <span class="string">'application/json'</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob(request, headers);</span><br><span class="line">navigator.sendBeacon(<span class="string">'url/to/send'</span>, blob);</span><br></pre></td></tr></table></figure>
<h2 id="关于-formdata-对象"><a class="markdownIt-Anchor" href="#关于-formdata-对象"></a> 关于 formData 对象</h2>
<p>xhr2 提供了 FormData 对象，为表单序列化和创建与表单相同的数据提供了便利。<br>
其主要用于发送表单数据，也可构造与表单相同的数据，还可以发送文件。</p>
<ul>
<li><strong>formdata 发送表单</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();<span class="comment">//创建 formData 对象</span></span><br><span class="line">formData.append(<span class="string">'name'</span>,<span class="string">'jack'</span>);<span class="comment">//添加表单项</span></span><br><span class="line">xhr.send(formData);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"user-info"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"user-name"</span>&gt;</span>姓名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"user-name"</span> <span class="attr">name</span>=<span class="string">"user-name"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"user-email"</span>&gt;</span>Email:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"user-email"</span> <span class="attr">name</span>=<span class="string">"user-email"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> <span class="attr">onclick</span>=<span class="string">"submitData()"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">       <span class="function"><span class="keyword">function</span> <span class="title">submitData</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">           <span class="keyword">var</span> http = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="actionscript">           http.open(<span class="string">"post"</span>, <span class="string">"formdata"</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="actionscript">           http.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">               <span class="keyword">if</span> (http.readyState == <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                   <span class="keyword">if</span> (http.status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">                       <span class="built_in">console</span>.log(http.responseText);</span></span><br><span class="line"><span class="actionscript">                   &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">                       alert(<span class="string">"Request was unsuccessful: "</span> + http.status);</span></span><br><span class="line"><span class="undefined">                   &#125;</span></span><br><span class="line"><span class="undefined">               &#125;</span></span><br><span class="line"><span class="undefined">           &#125;;</span></span><br><span class="line"><span class="javascript">           <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"user-info"</span>);</span></span><br><span class="line"><span class="actionscript">           <span class="keyword">var</span> formdata = <span class="keyword">new</span> FormData(form);<span class="comment">//用表单初始化一个 FormData 对象</span></span></span><br><span class="line"><span class="actionscript">           formdata.append(<span class="string">'额外字段'</span>, <span class="number">123</span>);<span class="comment">//字段值不是字符串，会转为字符串</span></span></span><br><span class="line"><span class="undefined">           http.send(formdata);</span></span><br><span class="line"><span class="undefined">       &#125;</span></span><br><span class="line"><span class="undefined">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>请求头信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryoCpZL9koEpmlasTW</span><br></pre></td></tr></table></figure>
<p>请求体信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryoCpZL9koEpmlasTW</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user-name"</span></span><br><span class="line"></span><br><span class="line">afafa</span><br><span class="line">------WebKitFormBoundaryoCpZL9koEpmlasTW</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user-email"</span></span><br><span class="line"></span><br><span class="line">afafa@<span class="number">163.</span>com</span><br><span class="line">------WebKitFormBoundaryoCpZL9koEpmlasTW</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"额外字段"</span></span><br><span class="line"></span><br><span class="line"><span class="number">123</span></span><br><span class="line">------WebKitFormBoundaryoCpZL9koEpmlasTW--</span><br></pre></td></tr></table></figure>
<p>和表单<code>enctype=&quot;multipart/form-data&quot;</code>提交一样的。<br>
用 express 处理提交，服务端：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * formData 上传表单</span></span><br><span class="line"><span class="comment"> * bodyParser 不能处理 formData 数据，需要额外的中间件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> multer = <span class="built_in">require</span>(<span class="string">'multer'</span>);</span><br><span class="line"><span class="keyword">let</span> upload = multer();</span><br><span class="line">app.post(<span class="string">"/formdata"</span>, upload.fields([]), (req, res) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req[<span class="string">'body'</span>]);</span><br><span class="line">    res.json(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>formdata 上传文件</strong> TODO 如何用 express 接收呢？<br>
客户端：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">name</span>=<span class="string">"fileinfo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>Your email address:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">autocomplete</span>=<span class="string">"on"</span> <span class="attr">autofocus</span> <span class="attr">name</span>=<span class="string">"userid"</span> <span class="attr">placeholder</span>=<span class="string">"email"</span> <span class="attr">required</span> <span class="attr">size</span>=<span class="string">"32"</span> <span class="attr">maxlength</span>=<span class="string">"64"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>Custom file label:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"filelabel"</span> <span class="attr">size</span>=<span class="string">"12"</span> <span class="attr">maxlength</span>=<span class="string">"32"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>File to stash:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">required</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Stash the file!"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="待完成"><a class="markdownIt-Anchor" href="#待完成"></a> 待完成</h2>
<ul>
<li>formData 对象</li>
<li>浏览器 Blod</li>
<li>arrayBuffer</li>
</ul>
<h2 id="xhr-封装"><a class="markdownIt-Anchor" href="#xhr-封装"></a> xhr 封装</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * options = &#123;</span></span><br><span class="line"><span class="comment">		url		提交请求的url</span></span><br><span class="line"><span class="comment">		method	请求的类型，默认为GET</span></span><br><span class="line"><span class="comment">        data	请求体的数据</span></span><br><span class="line"><span class="comment">        cache   是否缓存数据，默认为false</span></span><br><span class="line"><span class="comment">		async	是否以异步方式进行，默认为true </span></span><br><span class="line"><span class="comment">		success	成功后的处理方法</span></span><br><span class="line"><span class="comment">		error	失败后的处理方法</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> options = options || &#123;&#125;;</span><br><span class="line">    options.method = options.method.toUpperCase() || <span class="string">'GET'</span>;</span><br><span class="line">    options.async = options.async || <span class="literal">true</span>;</span><br><span class="line">    options.cache = options.cache || <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 格式化参数的函数</span></span><br><span class="line">    <span class="keyword">var</span> getParams = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> arr = [];</span><br><span class="line">        <span class="keyword">for</span> (param <span class="keyword">in</span> data) &#123;</span><br><span class="line">            <span class="comment">//查询字符串中每个参数的名称和值都必须使用 encodeURIComponent()进行编码</span></span><br><span class="line">            arr.push(<span class="built_in">encodeURIComponent</span>(param) + <span class="string">"="</span> + <span class="built_in">encodeURIComponent</span>(data[param]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在 url 末尾加上一个随机数，避免相同值使用 IE 缓存</span></span><br><span class="line">        <span class="keyword">if</span> (options[<span class="string">'cache'</span>]) &#123;</span><br><span class="line">            arr.push((<span class="string">"randomNum="</span> + <span class="built_in">Math</span>.random()).replace(<span class="string">"."</span>, <span class="string">""</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回带有 &amp; 的查询字符串</span></span><br><span class="line">        <span class="keyword">return</span> arr.join(<span class="string">"&amp;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> params = getParams(options[<span class="string">'data'</span>]);</span><br><span class="line">    <span class="keyword">var</span> http = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    http.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (http.status === <span class="number">200</span> || http.status === <span class="number">304</span>) &#123;</span><br><span class="line">            <span class="comment">// 成功</span></span><br><span class="line">            options.success &amp;&amp; options.success(http.response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 失败</span></span><br><span class="line">            options.fail &amp;&amp; options.fail(http.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (options[<span class="string">'method'</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">            http.open(<span class="string">"GET"</span>, options[<span class="string">'url'</span>] + <span class="string">"?"</span> + params, options[<span class="string">'async'</span>]);</span><br><span class="line">            <span class="comment">// 发送请求</span></span><br><span class="line">            http.send(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">            http.open(<span class="string">'POST'</span>, options[<span class="string">'url'</span>], options[<span class="string">'async'</span>]);</span><br><span class="line">            http.setRequestHeader(<span class="string">'content-type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>);</span><br><span class="line">            http.send(params)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'不支持的方法'</span>);</span><br><span class="line">            <span class="comment">//<span class="doctag">TODO:</span> 如何支持其他方法？</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>promise 版本：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">http</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  url = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  method = <span class="string">'get'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  data = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  dataType = <span class="string">'multipart'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  responseType = <span class="string">'json'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  headers = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> body = <span class="literal">null</span>;</span><br><span class="line">  method = method.toUpperCase();</span><br><span class="line">  <span class="keyword">if</span> (!url) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'url是必需参数！'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">xhr</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> http = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    http.responseType = responseType;</span><br><span class="line">    http.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="number">200</span> == http.status || <span class="number">304</span> === http.status) &#123;</span><br><span class="line">        resolve(http.response);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(http.statusText);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    http.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">      reject(e);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">switch</span> (method.toLowerCase()) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'get'</span>:</span><br><span class="line">        <span class="keyword">var</span> queryString = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">JSON</span>.stringify(data) !== <span class="string">'&#123;&#125;'</span>) &#123;</span><br><span class="line">          queryString = <span class="built_in">Object</span>.keys(data)</span><br><span class="line">            .map(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(key) + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(data[key]);</span><br><span class="line">            &#125;)</span><br><span class="line">            .join(<span class="string">'&amp;'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (queryString) &#123;</span><br><span class="line">          url += <span class="string">'?'</span> + queryString;</span><br><span class="line">        &#125;</span><br><span class="line">        http.open(<span class="string">'GET'</span>, url, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'post'</span>:</span><br><span class="line">        http.open(<span class="string">'POST'</span>, url, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'json'</span> === dataType) &#123;</span><br><span class="line">          body = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">          http.setRequestHeader(<span class="string">'content-type'</span>, <span class="string">'application/json;charset=UTF-8'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'urlencoded'</span> === dataType) &#123;</span><br><span class="line">          body = <span class="built_in">Object</span>.keys(data)</span><br><span class="line">            .map(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(key) + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(data[key]);</span><br><span class="line">            &#125;)</span><br><span class="line">            .join(<span class="string">'&amp;'</span>);</span><br><span class="line">          http.setRequestHeader(<span class="string">'content-type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'xml'</span> === dataType) &#123;</span><br><span class="line">          http.setRequestHeader(<span class="string">'content-type'</span>, <span class="string">'text/xml'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          body = data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(headers)) &#123;</span><br><span class="line">      http.setRequestHeader(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    http.send(body);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(xhr);</span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2>
<ul>
<li><a href="https://wangdoc.com/javascript/bom/xmlhttprequest.html" target="_blank" rel="noopener">XMLHttpRequest 对象 - JavaScript 教程 - 网道</a></li>
<li><a href="https://stackoverflow.com/questions/40523469/navigator-sendbeacon-to-pass-header-information" target="_blank" rel="noopener">Navigator.sendBeacon() to pass header information</a></li>
<li><a href="https://stackoverflow.com/questions/9181090/is-onload-equal-to-readystate-4-in-xmlhttprequest" target="_blank" rel="noopener">Is onload equal to readyState==4 in XMLHttpRequest?</a></li>
<li><a href="https://stackoverflow.com/questions/30522565/what-is-meaning-of-xhr-readystate-4" target="_blank" rel="noopener">What is meaning of xhr.readystate===4</a></li>
<li><a href="https://zqzhang.github.io/blog/2016/04/18/why-use-onload-in-cross-domain-ajax.html" target="_blank" rel="noopener">Why Use onload in Cross-domain Ajax</a></li>
<li><a href="https://xhr.spec.whatwg.org/#progressevent" target="_blank" rel="noopener">XMLHttpRequest Living Standard — Last Updated 28 November 2018</a></li>
</ul>

      
    </div>
    
<h3 style="text-align:center">如有帮助，谢谢您请我喝咖啡 <i class="fe fe-smile"></i></h3>
<p class="reward" style="text-align:center">
  <img src="https://raw.githubusercontent.com/jackchoumine/jack-picture/master/alipay2.jpg" title="支付宝扫一扫" alt="支付宝收款二维码" width="30%" height="30%" style="display:inline;"><img src="https://raw.githubusercontent.com/jackchoumine/jack-picture/master/weixin2.jpg" title="微信扫一扫" alt="微信打赏二维码" width="30%" height="30%" style="display:inline;">
</p>

    

  <div class="declare">
    <strong>本文作者：</strong>
    
      JackChouMine
    
    <br>
    <strong>本文链接：</strong>
    https://JackChouMine.github.io/2019/06/16/xhr-全面总结/
    <br>
    <strong>版权声明：</strong>
    本作品采用
    <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    进行许可。转载请注明出处！
    
      <br>
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
      <img alt="知识共享许可协议" title="CC BY-NC-SA 4.0" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png">
      </a>
    
  </div>

    <footer class="article-footer">
      <a data-url="https://JackChouMine.github.io/2019/06/16/xhr-全面总结/" data-id="ckd7fjfxh003noxqod24bbb0c" class="article-share-link">分享</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xhr/">xhr</a></li></ul>

    </footer>
  </div>

  
    
  <nav class="article-nav">
    
      <a href="/2019/06/16/几种重定向/" class="article-nav-link">
        <strong class="article-nav-caption">前一篇</strong>
        <div class="article-nav-title">
          
            几种重定向
          
        </div>
      </a>
    
    
      <a href="/2019/06/15/web-worker-实现浏览器多线程/" class="article-nav-link">
        <strong class="article-nav-caption">后一篇</strong>
        <div class="article-nav-title">web worker 实现浏览器多线程</div>
      </a>
    
  </nav>


  
  
  <div class="recommended_posts">
    <h3>推荐阅读</h3>
    <ul>
    
    
      <li>
        <a href="https://JackChouMine.github.io/2019/06/16/html5-websocket/" title="html5 websocket" target="_blank">
        html5 websocket
        </a>
      </li>
      
      <li>
        <a href="https://JackChouMine.github.io/2019/06/16/几种重定向/" title="几种重定向" target="_blank">
        几种重定向
        </a>
      </li>
      
      <li>
        <a href="https://JackChouMine.github.io/2019/06/15/web-worker-实现浏览器多线程/" title="web worker 实现浏览器多线程" target="_blank">
        web worker 实现浏览器多线程
        </a>
      </li>
      
      <li>
        <a href="https://JackChouMine.github.io/2019/06/09/Fetch-API-入门使用/" title="Fetch API 入门使用" target="_blank">
        Fetch API 入门使用
        </a>
      </li>
      
    </ul>
  </div>

  
    
  <div class="gitalk" id="gitalk-container"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: '90f92ec37c1bf3ff8c87',
      clientSecret: 'c746c91801c749223e933fb3393dd4fd7f0e53a6',
      repo: 'blog-comment',
      owner: 'jackchoumine',
      admin: ['jackchoumine'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

  

</article>



</section>
  <footer class="footer">
  
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 JackChouMine</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean" target="_blank">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <!--
 * @Description: 侧边栏
 * @Date: 2020-07-29 21:03:01
 * @Author: JackChouMine
 * @LastEditTime: 2020-07-29 21:31:46
 * @LastEditors: JackChouMine
-->
<button class="navbar-toggle"></button>

<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/portrait.png" alt="JackChouMine"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="GitHub" href="https://github.com/jackchoumine" target="_blank">
        <i class="fe fe-github"></i>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="stackoverflow" href="https://stackoverflow.com/users/6524962/jackchoumine" target="_blank">
        栈溢
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="思否" href="https://segmentfault.com/u/jackzhoumine" target="_blank">
        思否
      </a>
    </li>
    
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
    <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>



  <script src="/js/search.js"></script>


<script src="/js/ocean.js"></script>

</body>
</html>